# Tournament Automation Prototype Extended
# Features: Round-Robin, Single Elimination, Swiss (basic)
# Includes simulated matches, score submission placeholders, bracket updates, and opponent chat simulation

import itertools
import random

class Team:
    def __init__(self, name):
        self.name = name
        self.score = 0

    def __repr__(self):
        return self.name

class Match:
    def __init__(self, team1, team2):
        self.team1 = team1
        self.team2 = team2
        self.winner = None
        self.score_images = []  # placeholder for image submissions
        self.chat_log = []  # simulate opponent chat

    def play_match(self):
        # Simulate chat messages
        self.chat_log.append(f"{self.team1} says: GL!")
        self.chat_log.append(f"{self.team2} says: Have fun!")
        # Simulate score submission images
        self.score_images.append(f"Image_{self.team1}_vs_{self.team2}_1")
        self.score_images.append(f"Image_{self.team1}_vs_{self.team2}_2")
        # Randomly pick winner for simulation
        self.winner = random.choice([self.team1, self.team2])
        print(f"Match: {self.team1} vs {self.team2} | Winner: {self.winner}")
        return self.winner

class Tournament:
    def __init__(self, name, teams, format_type='round_robin'):
        self.name = name
        self.teams = [Team(t) for t in teams]
        self.format_type = format_type
        self.matches = []
        self.current_round = 1
        self.bracket = []

    # --- Round-Robin ---
    def generate_round_robin(self):
        self.matches = []
        for t1, t2 in itertools.combinations(self.teams, 2):
            self.matches.append(Match(t1, t2))

    def play_round_robin(self):
        print(f"--- Round Robin: {self.name} ---")
        for match in self.matches:
            match.play_match()

    # --- Single-Elimination ---
    def generate_single_elimination(self):
        teams = self.teams[:]
        random.shuffle(teams)
        self.bracket = []
        while len(teams) > 1:
            round_matches = []
            for i in range(0, len(teams)-1, 2):
                round_matches.append(Match(teams[i], teams[i+1]))
            if len(teams) % 2 == 1:
                print(f"{teams[-1]} gets a bye")
                round_matches.append(Match(teams[-1], None))
            self.bracket.append(round_matches)
            teams = [m.team1 for m in round_matches]

    def play_single_elimination(self):
        print(f"--- Single Elimination: {self.name} ---")
        round_num = 1
        while len(self.bracket) > 0:
            print(f"=== Round {round_num} ===")
            next_round_teams = []
            for match in self.bracket[0]:
                if match.team2 is None:
                    print(f"{match.team1} gets a bye")
                    next_round_teams.append(match.team1)
                else:
                    winner = match.play_match()
                    next_round_teams.append(winner)
            self.bracket.pop(0)
            if len(next_round_teams) > 1:
                new_round = []
                for i in range(0, len(next_round_teams)-1, 2):
                    new_round.append(Match(next_round_teams[i], next_round_teams[i+1]))
                if len(next_round_teams) % 2 == 1:
                    new_round.append(Match(next_round_teams[-1], None))
                self.bracket.append(new_round)
            round_num += 1

    # --- Swiss System (simplified) ---
    def generate_swiss(self, rounds=3):
        self.matches = []
        teams = self.teams[:]
        for r in range(1, rounds+1):
            random.shuffle(teams)
            round_matches = []
            for i in range(0, len(teams)-1, 2):
                round_matches.append(Match(teams[i], teams[i+1]))
            if len(teams) % 2 == 1:
                print(f"{teams[-1]} gets a bye")
                round_matches.append(Match(teams[-1], None))
            self.matches.extend(round_matches)

    def play_swiss(self, rounds=3):
        print(f"--- Swiss System: {self.name} ---")
        self.generate_swiss(rounds)
        for match in self.matches:
            if match.team2 is not None:
                match.play_match()

# --- Example usage ---
teams = ['Alpha', 'Bravo', 'Charlie', 'Delta']

# Round Robin
tourney_rr = Tournament('League Tournament', teams, 'round_robin')
tourney_rr.generate_round_robin()
tourney_rr.play_round_robin()

print('\n')

# Single Elimination
tourney_se = Tournament('Single Elimination Tournament', teams, 'single_elimination')
tourney_se.generate_single_elimination()
tourney_se.play_single_elimination()

print('\n')

# Swiss System
tourney_swiss = Tournament('Swiss Tournament', teams, 'swiss')
tourney_swiss.play_swiss(rounds=3)